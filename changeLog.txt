========11/5/13========
Primary update here was adding in the "Macguyver" fix for MET smearing, wherein I have "calculated" the effects of jet smearing on MET in separate nTuples (nTuples from the MET JINST performance study) and have made smearing functions to propagate those effects into the distributions in the Stop analysis

Note, I ran into an interesting issue while working on this. I kept hitting "double free or corruption" errors, which stemmed from the following. I had a TFile, I grabbed a hist from said file (i.e. grabbed the pointer to the memory address of the histogram) in a given function, and in the course of said function I de-referenced the pointer and pushed the resulting hist into a vector. When this function closed it killed the memory associated with the dereferenced histogram (aka what is stored at the memory address that the pointer pointed to), and then when it closed the input TFile it tried to delete the already deleted memory address
====StopFillFunctions.h====
Added in version of METSystShift to work with PFJets

Fixed a bug with the "special" MT2 Unclustered Energy Smearing

Added in a the string key map set for "smeared jets", SetStringKeyMapSmearJets,
as well as the special version with MT2 special cases, SetStringKeyMapSpecialSmearJets

Added in the auto Histogram Filler for stuff that remains after initial fillings,
HistogramFillOneDeeSystRemain

====StopFunctionDefinitions_v2.h====
Fixed the SmearJet function to be better in sync with the official version of this code, SmearedJetProducerT.h, but we're still not using it for now

Made a new version of the function, "AddSystHists", to better work with my current sytematics structure

Added a function to make the vector of HistogramTs for the smeared histograms, OneDeeSmearHistTVec

Changed the function that returns the vector of SystTs, SystVec, to have a "jet smear option" so that you don't grab the smeared jets systematic when you don't need to

Added in the function, SmearHist, that grabs the correct TH2F to make 1D smearing histograms from (based upon inputfile's name)

Added in the function, SetMETSmearHistVec, that makes the vector of TH2Fs for smearing purposes based upon the vector of input TFiles

Added in the function, DeltaMET, that calculates a change to the MET value based upon the input vector of 1D smearing histograms (by finding the appropriate bin and what-not)

====StopPlotSetup.h====
Added in BTagging and JetSmearing systematics into the plotting

Working on adding in a SmoothedTGraph function which will smooth out input TGraphs

====StopStructDefinitions.h====
Minor changes to pre-existing structs -- function "SetNonBTagInfo" used for the BTag systematics for EventJetInfo (i.e. used in NewOviStopPlotFillerRunOnSkim_wSyst.C
====NewOviStopPlotFillerRunOnSkim_wSyst.C====
Added in MET smearing via "hack" method (for this macro, that consists of just changing how information is grabbed)

Added in JetSmear systematic

Fixed some minor bugs here and there:
Bug with "smeared histograms" x axis for MT2ll
Bug with "special" systematics and filling of histograms

====JetResolution.txt====
Fixed the ordering of the numbers, which was reversed for some of the rows

====NewOviStopPlotSkimmer.C====
Added in stuff (TFile names, histogram names, etc.) for MET smearing "hack"

Added in ability to run with only a sub-sample of the file (i.e. limit statistics for fasting commissioning)

Added in unclustered energy systematic to MET

====MT2CutYieldCalc.C====
Working on updating the code to work with smeared version of histograms

====StopPlotsSpectraShowNewDESY_wSyst.C====
Added in stuff for plotting Smeared MET histograms


========10/24/13========
Another structure update to the code, not as major as 10/15/13
This time, it was to facilitate the filling of plots, which is done in NewOviStopPlotFillerRunOnSkim_wSyst.C
The way that macro works is that it draws a list of HistogramStructures from an external header file, books these histograms and puts them into a map (associated with a pairing of the HistogramStructure and a "SubsampleStructure"). The code runs through the events, calculates whatever hasn't been calculated yet and makes a mapping of strings to float values -- the aforementioned HistogramStructures have strings associated with them which match up with the strings used in the map<string, float>. Finally, there is a mapping of "SubsampleStructure" to booleans, where for the given event it falls into various "subsamples" and so I put "true" in for those subsamples. So, when it comes time to fill histograms, you iterate through the histograms in the event, check if their associated subsample boolean is true; if so, you grab the float associated with their string designating what variable, and then fill them

The major structure updates were basically putting in functions to handle most of this automatically, in particular to facilitate dealing with systematics. The bulk of these functions can be found in StopFillFunctions.h and include,
CorrectPlusSetMET
CalcMT2
EventPassTrigger
nVtxWeight
SetEventInformation
SetStringKeyMap
SetStringKeyMapSpecial
LepInBarrel
LepInEndcap
DiLeptonGeometry
SetPassCutMap
HistogramFillOneDee
HistogramFillOneDeeSyst
HistogramFillTwoDee
HistogramFillTwoDeeSyst
HistogramFillThreeDee
HistogramFillThreeDeeSyst

I have also started working on a macro to automatically check if two separate versions of a given data file contain different histograms (both in what histograms and in the stats of histograms that are the "same" in a "name" sense) This is to facilitate commissioning further changes to the code (i.e. for basic structure changes that shouldn't change final results, we can compare old vs. new and expect to see no change)
====StopFillFunctions.h====
Moved the function "PileupRW" here 
====StopFunctionDefinitions_v2====
Moved SystT, SampleT, and HistT structure definitions to StopStructDefinitions.h
Moved deltaR and dPhi functions to StopStructDefinitions.h
Moved the function "PileupRW" from here (see StopFillFunctions.h)
Moved the function DeltaMT2UncEn to StopStructDefinitions.h
Added verbosity to MuonPickOviSyst

Slightly changed how lepton jet checking works (see the new function "isLeptonJet")
If the jet we're currently looking at has pT above a certain threshold (currently set at 20 GeV), then we only care to check isolated leptons that have pT above a certain threshold (currently set at 10 GeV), otherwise we check against all isolated leptons. This is to be as correct as possible for low pT jets (i.e. we don't want to overestimate systematics by either double counting them or assigning JES systematics to a lepton-like object, which has better energy scale certainty than that, and furthermore, shouldn't have been subject to Type1 corrections in the first place, due to the automatic checks against correction lepton-like jets)

Fixed how "edge" effects are handled in JetResolutionHighPt, which grabs jet resolution from a TF1 based on what eta. Namely, if there's ambiguity (a jet right on a bin edge), you grab the TF1 from the higher of the two ambiguous eta bins

Added in some saving of information for the jet smearing (whether the given jet is GenJetMatched and what the energy difference between the matched genjet and the given jet is.

Changed how systematics work, specifically how they are demarcated in number,
See the function "SystVec"

Fixed a bug in "DescriptorString" (Values for different Eta bins had been flipped)

====NewOviStopPlotFillerRunOnSkim_wSyst.C====
A LOT of changes happened to this file (I believe 2400 lines or so of code were cut from it), mostly related to the structure change discussed above

The ones that aren't related, are very minor minor changes, related to file names of saved output files

====NewOviStopPlotSkimmer.C====
Added in some histograms for "investigating" the jet smearing, namely the difference in energy between smeared and unsmeared jets

Added in separate verbosity levels for leptons and for jets so that I can be specific in which debug info I want to see

Fixed a bug for LepESShiftDown, which was pushing isolated leptons into LepESShiftUp vector, so that all events were failing LepESShiftDown

Fixed a bug where doEvent_LepESUp was checking ELI_LepESDown.doEvent

====StopPlotsSpectraShowNewDESY_wSyst.C====
Added in a crucial line,
#include "../HeaderFiles/StopStructDefinitions.h"
====MT2CutYieldCalc.C====
Added in a crucial line,
#include "../HeaderFiles/StopStructDefinitions.h"
====METPhiCorrCalculator.C====
Added in a crucial line,
#include "../HeaderFiles/StopStructDefinitions.h"

========10/15/13========
Big Structure update to the code, plus some physics as well
--Added in structure called ElectronEventPointers plus analogous ones for Muons, PFJets, and GenJets
-These structures are true C++ style structures in that they are just repositories to agglomerate all the various "vectors" containing event information for the objects (kinematics, quality cut variables) in an easily handled structure to tidy up the code
--Added in structures for PFJets to basically make it easier to pass around the 4-vectors and associated jet information (b-tag discriminant value, parton flavor). This also facilitates sorting the Jets by pT after smearing, for example (i.e. sorting the PFJet structure so as to maintain the associated non-kinematic variables with the correct jets)
SImilar thing was added for GenJets and Leptons (note, the need to sort Leptons and keep associated information came up in the code where I select the dilepton pair -- this was a hindrance to syncrhonization with Oviedo in the EMu channel)
--BTagging Scale factors were added in (using BTagSFUtil.C and BTagSFUtil.h -- both should be located in HeaderFiles along with their associated additional files) -- See the Skimming code to see how they play out
--Worked on implementing Jet Energy Smearing for the purposes of MET agreement - this is still a work in progress but I've more or less developed the smearing code

Added a lot of "verbosity triggered" debug statements to facilitate synchronization with Oviedo, these are controlled by the "levelVerbosity" variable

Consequently, a lot of the changes in this revision are updates to the code to utilize the new structures, implement in BTag ScaleFactors, correctly handle the Smeared Jet collections, etc.

Nevertheless, will list some specific changes down below
====HistogramSystematics2.h====
Added in some "verbosity level" triggered debug statements (commenting out the debug statements)
====StopFillFunctions.h====
Updated MET Phi Corrections (including a trigger for ReReco)
Added METSystShift function to this file
Removed "EventType" function (spurious -- not needed because other functions handle it)
Updated MC scale factors
====StopFunctionDefinitions_v2.h====
Fixed an absolute value of SCEta (was missing one -- line below)
-    if (SCEta >= SCEtaMax || ((SCEta >= SCEtaBarrelCut ) && (SCEta <= SCEtaEndcapCut))) {
+    if (fabs(SCEta) >= SCEtaMax || ((fabs(SCEta) >= SCEtaBarrelCut ) && (fabs(SCEta) <= SCEtaEndcapCut))) {
fixed the same situation with the deltaPhiIn, DeltaEtaIn and other electron quality cuts

The functions JetResolutionHighPt, SmearJet, ResolutionHistMaker, VecJetHighPtResolutionTF1, and JetSmear are all related to the Jet Energy Smearing -- they should be fairly self-explanatory if not well commented

Added in the systematics histogram booking for the BTag scale factors -- still working on this a bit (part of why I developed these structures)

Changed MT2lblb blinding to 170 GeV (to make a cleaner cut -- old value was 172)

Added in ReReco data as an option (including properly showing its name in output files)

Added in ability to calculate METPhi corrections, for example the function VectorDist is needed for this, along with HistogramAdderDataTwoDee

Added in some functions to facilitate making one and two-dimensional figure of merit plots
Fixed a lot of minor things that were hindering stuff (like saving as .C, I had plots with histograms with spaces in the name which screws up ROOT)

Made function for the 1D F.O.M. plot "FOMHist"

====NewOviStopPlotFillerRunOnSkim_wSyst.C====
Added in specific PU reweighting for signal (still have to add in specific scale factors
Recalculated Oviedo PURW
Associated stuff for BTag SF Systematic, want to fix this somewhat, however
====NewOviStopPlotSkimmer.C====
Made some files for the Jet Energy Smearing that I grab in here
Most of the structure changes talked about at the very beginning are found in this file
Added in ability to run on a specific run:event combo

The btagging scale factor and associated systematic has different implementation/values for signal, as can be seen in its implementation here

====StopDict.cpp====
Added in StopStructDefinitions.h into the dictionary so it gets compiled properly
====MT2CutYieldCalc.C====
Associated stuff for making TwoDee and OneDee F.O.M. hists
Associated stuff for allowing this code to calculate Data Driven TTBar normalization scale factor
Updated said scale factor

====StopPlotsSpectraShowNewDESY_wSyst.C====
Added in ability to turn off the legend when plotting (for cases where it will overlap with the histograms)
Added in ability to try and add multiple samples in together to make a composite "sample" to plot -- central value works right now but still debugging the systematics (command line option is "multiChan" followed by the multiChanSetupFileName) I've included an example file for it, but still need to write the readMe for it
====plotHaddersStop.C====
Added in ReReco hadding (i.e. luminosity scaling)


====ADDITIONAL MACROS/FILES====
Added in the macro for making the Signal PU -> SM PU reweighting distribution, "PURWHistMaker.C"
Added in the JetResolution (low pT jets) text file
Added in the example "Multi channel plot add" file "testInclusive.txt"
Added in the macro to calculate METPhi corrections, "METPhiCorrCalculator.C"
Added all the associated BTagSF files
Added in the Data/MC Jet Resolution smear factor file, "pfJetResolutionMCtoDataCorrLUT.root"
========9/25/13========
Worked on synchronizing with Oviedo code results
====StopFunctionDefinitions_v2.h====
Fixed minor bug where ECALBarrelEta end was listed as 1.442 instead of 1.442

Changed around Electron selection
Added in cutting on requiring PFElectronPt and ElectronPt within 10 GeV
Added in cuts on Electron DeltaPhiIn, DeltaEtaIn, SigIetaIeta, HtoE ratio
Changed cut on electron object eta to be cutting on electron supercluster eta
Above cuts depend upon electron being either "isEE" or "isEB"
Added in cuts for electron impact parameter (w.r.t. PV) and deltaZ (w.r.t. PV)
Added in cuts for electron "no. of missing hits" and electron's abs(1/E -1/p)

Changed around Muon selection
Added in cutting on requiring PFMuonPt and MuonPt within 5 GeV
Fixed bug in Muon DZ cut, which was always checking against leading vertex -- now I have to find the leading "good" vertex in a function called goodVertexSelection
Added in cuts on ("isGlobalMuon" or "isTrackArbitratedMuon")
Added in cuts on Muon number of matching stations, number of valid pixel hits in the tracker, number of layers in the muon system
Changed isolation variables to use the 0.3 cone variety

Changed Jet stuff
DeltaR cone for cutting leptons upgraded to 0.4 from 0.5
Fixed a minor bug with getting Jet B-tags -- I create a vector of good jets and then iterate through to check whether the given jet passes our b-tag, but the issue was that I was bringing in the vector of b-tags for EVERY jet, not the jets that passed quality cuts
Have almost finished putting in a "fix" for JES systematics, wherein I save the list of good jets passing our basic Jet ID cuts. Later I cut on pT for this collection to select our jets but for MET JES purposes I keep all jets with pT > 9 GeV. Initially I was cutting on |eta| < 2.4 (matching our jet selection) but I've put the cut later on and just need to check that it's not too extreme a difference (i.e. that it makes sense)

Added in blinding for an EMu channel that was missing it (DiLepInZMass2Jets1BJetMET>=40)
Fixed bug in the sorting of backgrounds

Added in functions for making the 2D Figure of Merit (S/sqrt(S+B)) plots, stuff like SystHistFinderTwoDee and HistogramAdderMC (overloaded for TH2Fs)
and, perhpas most import, the function FOMHist

Added in UncEnSC systematics for the "error" graphs

====NewOviStopPlotFillerRunOnSkim_wSyst.C====
Fixed ECALBarrel Eta End bug (1.442 vs. 1.4442)
====NewOviStopPlotSkimmer.C====
Added in necessary branches/variables for all the additional ish to cut on (described above)
Fixed MassPoint rounding number (25 instead of 10) for T2bw signal files

====MT2CutYieldCalc.C====
Started adding in ability to calculate TTBar normalization with this code (not finished yet, I believe)
Added in F.O.M. plot making to this macro
Added in two different ways of getting the yield, the basic yields for various channels (doYieldV2) and the full selection yields with systematics (doYieldV1); by default doYieldV1 is turned ON
Added in different version numbers ability

========9/18/13========
HeaderFiles/StopFunctionDefinitions_v2.h
Moved a number of functions into a different file, StopFillFunctions.h, in the same directory
Added a function, OneDProjectionReturnVec, related to the purposes of calculating OneD pdfs (by projecting from input 2D histograms) for the MT2 Unclustered energy systematics
Added a function, DeltaMT2UncEn, which given an input vector of TH1Fs (i.e. input PDFs), an input 2D histogram (to find which TH1F to grab), and an input MT2 value, calculates the DeltaMT2 coming from unclustered energy systematics

Added in a function, ElectronEffectiveArea, for calculating effective area of electrons (related to picking isolated electrons)
Updated the electron picking functions to be in line with Oviedo's strategy (and the correct one from EGamma POG perspective)
Modified the Electron and Muon picking functions to allow for calculating systematic shifted (lepton ES systematic) versions of the muons/electrons

Added in a function, IsoLeptonsPickDESY, to pick the IsoLeptons for Skimming DESY
(including lepton energy scale systematics)

Added in a function, LeptonPair, that takes in the vector of input "isolated" leptons and finds the pair satisfying event selection requirements (if any exist)

Added in a function, JESUncertFactor, that calculates the JES systematic uncertainty given an input 2D histogram of uncertainties, what shift direction (and magnitude!) and the input jet Pt and jet Eta

Added in a function, JetInfoDESY, that finds the number of jets passing selection requirements (including being separate from the isolated leptons in the event), and allows for JES systematics calculations. This function does NOT do the Pt cut; that has been relegated to a different function, JetPtCut

Added in MT2 Unclustered Energy systematics and Jet Energy systematics to the relevant spots
Re-added back in systematics for 2D histograms (made it general, but in the end it only applies additionally for 2D histograms now)

Changed binning for energy/pT plots to be every 10 GeV (to better show cuts)
Added three 1D hists, relative lepton PF isolation (for lead and sub-lead lep) and the "channel cut flow"

Removed some unnecessary 2D histograms and added in MT2ll vs. MT2lb histogram

Properly blinded the emu in Z mass region w/ jet cuts

Added a MT2ll > 80 blinded sub-channel

Added events in the Z mass, with either exactly 0 or 1 jets (two separate channels)
==
StopPlotHaddInfo.h
Changed how the Oviedo normalization numbers are accessed

fixed some minor bugs, notable one being with ttbar exclusive sample cross sections
Added in some additional samples (in appropriate spots) that were available from Oviedo
==
StopPlotSetup.h
Fixed some minor bugs
Fixed inputfile grabbing to work with DESY skimmed outputs
Added in JetEnergy Scale systematics (need to add in unclustered energy systematics still)
Added in "Other nTuple ratio plots", an option to show whichever nTuple wasn't grabbed (of the di-set of Oviedo/DESY) and display it on the same ratio plot (as a different color) for comparison purposes
Added in "Smart Ratio Axes", an option that "smartly" sets the ratio axes to facilitate full visibility of the Data/MC ratios
==
NewOviStopPlotFillerRunOnSkim_wSyst.C
Moved MetPhiCorrect function to the function header files
Added in unclustered energy and Jet energy systematics (Jet energy to everything where it's relevant, unclustered just to MT2 variables)
Added in option for changing the sub-lepton pT cut
Re-added in systematics for 2D plots
Added in proper effects of energy scale systematics on event selection (i.e. lepton ES on dilepton selection as an example) -- NOTE this was a NON-TRIVIAL CHANGE. MANY LINES changed as a result!
Added in trigger stuff
Removed DESY plot making from this script (DESY now gets skimmed like Oviedo)
Moved getMT2 function out of this file into a header file
==
NewOviStopPlotSkimmer.C
Added in JES systematics, including grabbing JES systematics 2D hists
Accounted for the effects of JES and LepES systematics on event selections (affecting what gets saved)
Included trigger information
Updated electron and muon selections (especially electrons) for Oviedo Skimming
ADDED DESY to the skimmer -- lots of lines of code
Added option for picking out a specific run and printing information from that run
==
StopDict.h (in both PlotMaking and PlotSkimming areas)
Updated to include the additional relevant file, StopFillFunctions.h"
==
StopPlotsSpectraShowNewDESY_wSyst.C
Lots of minor changes related to what's been discussed for above listed changes in other files
Some cleaning of the code
==

8/16/13 9:13 A.M. EST
HeaderFiles/HistogramSystematics2.h
-Removed some extraneous debug statements
-Slightly changed how graph names are saved (to make debugging easier)
-Changed the algorithm for what happens if the script cannot find any histogram with the systematic name in question (for example genStop Xsec in non-signal files)
^technically, I've also changed how the histograms are grabbed to make sure to grab central value histograms whenever possible if the given systematic isn't available (so that net error for said systematic for said histogram ends up being 0)

HeaderFiles/StopFunctionDefinitions_v2.h
-Added in additional Scale Factor for the three di-lep channels, constructed in such a way to bring the TTBar data-driven scaling factor (i.e. normalization factor in MT2 control region) into agreement for all three dilep channels
-Added in some additional histograms:
--)MT2ll for different delta phi regions between the leptons
--)MT2lb for different delta phi regions between the "b-lep" vecs (i.e. the 'b-jet' lepton pairings that are used to calculate the MT2lb)
--)MT2lb for different delta phi regions between the two leading jets (need to check this to make sure I use the "correct" jets)
--)MET/M_effective, MET/(S_T + MET), including for different "passes MT2ll Cut"
-Removed H_MT2lb_vs_DeltaPhiLepB0LepB1 for space purposes
-Removed SampleT events_NBJetsGeq1 for space purposes

HeaderFiles/StopPlotSetup.h
-Added in sorting of histograms (for the purposes of the legend/log scale sensibilities) -- right now sorting on a predetermined order but ostensibly could add in sorting by the "integral" of the histograms in question
-Fixed handling of "exclusive samples" for TTbar in Oviedo for madgraph (need to confirm this works 100% of the time though)
-Added in ability to load in NonFineBin signals for plotting purposes (still needs some work though)
-Added in function HistogramUnderflowOverflow, which basically sets up under/over flow bins if the associated booleans are true
-Changed how histograms are picked out of the file; since TH(1/2/3)(F/D) all inherit from TH1 class, I grab TH1 and then project/cast into appropriate histogram depending upon the circumstances (haven't yet implemented this for the 2D and 3D case, but it works for the 1D case, both for central values and for systmatics)
-Made a function, SystGraphMakers, which creates the associated systematic error "graphs" for the various things (SM bkgd, Signal); this is a carbon copy of the associated code that was in the plot showing macro, just put here to save space
-Changed color of systematics bands in ratio plots to be kYellow
-Added in legend for systematics band in ratio plots

PlotMakingCode/NewOviStopPlotFillerRunOnSkim_wSyst.C
-Removed 2D and 3D systematics for now (space purposes)
-Added in necessary calculations/variables for the histograms I added in the StopFunctionDefinitions_v2.h
-Fixed weights for the Stop signal (for example LepEFSF systematics)

PlotShowingCode/StopPlotsSpectraShowNewDESY_wSyst.C
Associated changes in StopPlotSetup.h also were implemented here

JESUncertHistMaker.C
-Added in this macro to calculate the TH2s associated with the JES uncertainties from an input text file (see associated readme file, JESUncertMakerREADME)

MT2CutYieldCalc.C
-Added in this macro to calculate yield of data, SM backgrounds, and Signal in various MT2 cut regions, with systematics included (see associated readme file, MT2CutYielREADME)

changeLog.txt
-Come on, I'm not going to get that meta on you ;)

===========================================================================
===========================================================================
===========================================================================
===========================================================================

8/6/13 2:37 A.M. EST
HistogramStyleFunctions.h
Added in Line Style setting for HistogramMainAttSet (and also onti Graph Copy style function, HistToGraphCopyAtt)

HistogramSystematics2.h
Changed clonePoints around so that it no longer clones points with 0 bin content

StopPlotSetup.h

Added in stuff to deal with the "signal",
including function to calculate skim efficiency (for normalization purposes
A function to grab multiple Stop Mass Points files
A function that sets the Stop Legends
A function that plots the stop signal on top of pre-existing plot (no systematics... yet)

Added in "Rare" backgrounds into the plotting admixture for Oviedo
Added in ability for "exclusive" backgrounds into the plotting admixture for Oviedo

StopPlotsSpectraShowNewDESY_wSyst.C
Added in stuff for Stop Signal Plotting
